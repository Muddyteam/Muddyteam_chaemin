<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>카카오맵 API</title>
    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=984758e5ca934480c68000ae01d0f4ce"></script>
</head>
<body>
<div id="map" style="width:100%;height:100vh;"></div>
<script>
    // DOMContentLoaded 이벤트 사용
    document.addEventListener('DOMContentLoaded', function () {
        // 카카오맵 초기화
        var mapContainer = document.getElementById('map'),
            mapOption = {
                center: new kakao.maps.LatLng(36.586285, 126.839239), // 충청도 중심 좌표
                level: 11// 지도의 확대 레벨
            };
        var map = new kakao.maps.Map(mapContainer, mapOption);

        // 카카오 로컬 API를 사용하여 '충청' 지역에서 '갯벌' 검색
        var apiKey = 'e31961d649db20096b9c38a445e3d04d';
        var query = '갯벌 체험장 충청';
        var apiUrl = 'https://dapi.kakao.com/v2/local/search/keyword.json?query=' + encodeURIComponent(query) + '&size=10';

        fetch(apiUrl, {
            headers: {
                'Authorization': 'KakaoAK ' + apiKey
            }
        })
            .then(response => response.json())
            .then(data => {
                // "사무실"이 포함되지 않은 검색 결과 필터링
                var filteredPlaces = data.documents.filter(doc => !doc.place_name.includes('사무실'));

                var places = filteredPlaces.map(doc => ({
                    name: doc.place_name,
                    address: doc.address_name,
                    lat: parseFloat(doc.y),
                    lng: parseFloat(doc.x)
                }));

                // 검색 결과를 지도에 표시
                places.forEach(function(place) {
                    var markerPosition = new kakao.maps.LatLng(place.lat, place.lng);
                    var marker = new kakao.maps.Marker({
                        position: markerPosition
                    });
                    marker.setMap(map);

                    var infowindow = new kakao.maps.InfoWindow({
                        content: '<div style="padding:5px;">' + place.name + '<br>' + place.address + '</div>'
                    });

                    // 마커 클릭 시 정보 창 열기
                    kakao.maps.event.addListener(marker, 'click', function() {
                        infowindow.open(map, marker);
                    });

                    // 마커 외부 클릭 시 정보 창 닫기
                    kakao.maps.event.addListener(map, 'click', function() {
                        infowindow.close();
                    });
                });
            })
            .catch(error => console.error('Error:', error));
    });
</script>
</body>
</html>
